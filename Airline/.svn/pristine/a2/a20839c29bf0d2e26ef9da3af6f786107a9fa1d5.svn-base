import java.awt.Dimension;
import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Observable;
import java.util.Observer;

import javax.swing.*;
import javax.swing.event.ListSelectionEvent;
import javax.swing.event.ListSelectionListener;

// Generated by Together
// Edited by Nganga Njiraini

/**
 * An interface to SAAMS:
 * Maintenance Inspector Screen:
 * Inputs events from the Maintenance Inspector, and displays aircraft information.
 * This class is a controller for the AircraftManagementDatabase: sending it messages to change the aircraft status information.
 * This class also registers as an observer of the AircraftManagementDatabase, and is notified whenever any change occurs in that <<model>> element.
 * See written documentation.
 *
 * @stereotype boundary/view/controller
 * @url element://model:project::SAAMS/design:node:::id4tg7xcko4qme4cko4swuu.node146
 * @url element://model:project::SAAMS/design:view:::id15rnfcko4qme4cko4swib
 * @url element://model:project::SAAMS/design:view:::id4tg7xcko4qme4cko4swuu
 * @url element://model:project::SAAMS/design:node:::id15rnfcko4qme4cko4swib.node107
 * @url element://model:project::SAAMS/design:view:::id3y5z3cko4qme4cko4sw81
 */
public class MaintenanceInspector extends JFrame implements Observer, ActionListener {
    /**
     * The Maintenance Inspector Screen interface has access to the AircraftManagementDatabase.
     *
     * @clientCardinality 1
     * @supplierCardinality 1
     * @label accesses/observes
     * @directed
     */
    private AircraftManagementDatabase aircraftManagementDatabase;

    /**
     * The GateConsole interface has access to the GateInfoDatabase.*
     *
     * @supplierCardinality 1
     * @clientCardinality 0..*
     * @label accesses/observes
     * @directed
     */
    private GateInfoDatabase gid;

    private ArrayList<Integer> mCodes1;
    private ArrayList<Integer> mCodes2;

    private JTabbedPane tabPanel;

    private JList<String> maintainList;

    private JTextArea AircraftStatus;

    private JButton reportFaultBtn;
    private boolean newfault = false;
    private JTextArea maintDescription;
    private JButton completeMaintenanceBtn;

    private JList<String> faultyList;
    private JTextArea faultDescription;
    private JButton finishRepairBtn;

    public MaintenanceInspector(AircraftManagementDatabase amd) {
        mCodes1 = new ArrayList<Integer>();
        mCodes2 = new ArrayList<Integer>();
        amd.addObserver(this);
        this.aircraftManagementDatabase = amd;
        initGUI();
    }

    private void initGUI() {
        tabPanel = new JTabbedPane();
        getContentPane().add(tabPanel);
        initTab1();
        initTab2();

        setTitle("Maintenance Inspector");
        setVisible(true);
        setSize(550, 350);
        setLocation(650, 600);
        setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);
    }

    private void initTab1() {
        JPanel maintainPanel = new JPanel();
        maintainPanel.setLayout(new BoxLayout(maintainPanel, BoxLayout.PAGE_AXIS));
        maintainPanel.add(Box.createRigidArea(new Dimension(0, 5)));

        JLabel lblMaintain = new JLabel("Ready for Maintenance");
        maintainList = new JList<String>(new DefaultListModel<String>());
        JScrollPane mScroll = new JScrollPane(maintainList);
        maintainList.setVisibleRowCount(aircraftManagementDatabase.maxMRs);
        maintainList.addListSelectionListener(new ListSelectionListener() {
            @Override
            public void valueChanged(ListSelectionEvent arg0) {
                if (!(maintainList.getSelectedIndex() == -1)) {
                    int i = maintainList.getSelectedIndex();
                    AircraftStatus.setText(aircraftManagementDatabase.getRecordDetails(mCodes1.get(i)));
                }
            }
        });

        JLabel lblInfo = new JLabel("Aircraft Info");
        AircraftStatus = new JTextArea();

        completeMaintenanceBtn = new JButton("Complete Maintenance");
        completeMaintenanceBtn.addActionListener(this);

        maintainPanel.add(lblMaintain);
        maintainPanel.add(mScroll);
        maintainPanel.add(lblInfo);
        maintainPanel.add(AircraftStatus);
        maintainPanel.add(completeMaintenanceBtn);

        JPanel faultPanel = new JPanel();
        faultPanel.setLayout(new BoxLayout(faultPanel, BoxLayout.PAGE_AXIS));

        faultPanel.setBorder(BorderFactory.createEmptyBorder(10, 10, 10, 10));
        reportFaultBtn = new JButton("Report Fault");
        reportFaultBtn.addActionListener(this);

        maintDescription = new JTextArea(5, 10);
        maintDescription.setLineWrap(true);
        maintDescription.setWrapStyleWord(true);
        JScrollPane jsp = new JScrollPane(maintDescription);

        faultPanel.add(reportFaultBtn);
        faultPanel.add(jsp);

        JPanel panel = new JPanel();
        panel.setLayout(new GridLayout(1, 2));
        panel.add(maintainPanel);
        panel.add(faultPanel);
        tabPanel.addTab("Maintenance", panel);
    }

    private void initTab2() {
        JPanel faultDesPanel = new JPanel();
        faultDesPanel.setLayout(new BoxLayout(faultDesPanel, BoxLayout.PAGE_AXIS));
        faultDesPanel.add(Box.createRigidArea(new Dimension(0, 5)));

        JLabel lblfList = new JLabel("Aircraft requiring repair");
        faultyList = new JList<String>(new DefaultListModel<String>());
        faultyList.setFixedCellWidth(400);
        faultyList.addListSelectionListener(new ListSelectionListener() {
            @Override
            public void valueChanged(ListSelectionEvent arg0) {
                if (!(faultyList.getSelectedIndex() == -1)) {
                    int mCodeIndex = faultyList.getSelectedIndex();
                    faultDescription.setText(aircraftManagementDatabase.getRecordDetails(mCodes2.get(mCodeIndex)));
                }
            }
        });
        JScrollPane fScroll = new JScrollPane(faultyList);

        faultDescription = new JTextArea("This is a test");

        finishRepairBtn = new JButton("Complete Repair for selected aircraft");
        finishRepairBtn.addActionListener(this);
        faultDesPanel.add(lblfList);
        faultDesPanel.add(fScroll);
        faultDesPanel.add(faultDescription);
        faultDesPanel.add(finishRepairBtn);

        tabPanel.addTab("Fault Repairs", faultDesPanel);
    }

    @Override
    public void actionPerformed(ActionEvent evn) {
  	  if(evn.getSource() == completeMaintenanceBtn){
  	      int index = maintainList.getSelectedIndex();
  	      if(maintainList.getSelectedIndex()== -1){
              JOptionPane.showMessageDialog(this,"Please select an aircraft");
          }
          else{
              int mCode = mCodes1.get(index);
              int status = aircraftManagementDatabase.getStatus(mCodes1.get(index));
              if(status == ManagementRecord.READY_CLEAN_AND_MAINT){
                  aircraftManagementDatabase.setStatus(mCode,ManagementRecord.OK_AWAIT_CLEAN);
              }
              else if(status == ManagementRecord.CLEAN_AWAIT_MAINT){
                  aircraftManagementDatabase.setStatus(mCode, ManagementRecord.READY_REFUEL);
              }
          }
      }

        if (evn.getSource() == reportFaultBtn) {
            int index = maintainList.getSelectedIndex();

            if (maintainList.getSelectedIndex() == -1) {
                JOptionPane.showMessageDialog(this,"Please select an aircraft");
            }
            else{
                String description = maintDescription.getText();
                if(description.equals("")){
                    JOptionPane.showMessageDialog(this, "Please provide a description of the fault");
                }
                else{
                    int mCode = mCodes1.get(index);
                    aircraftManagementDatabase.faultsFound(mCode, description);
                    JOptionPane.showMessageDialog(this, "Fault Acknowledged and Reported");
                    maintDescription.setText("");
                }
            }
        }

        if (evn.getSource() == finishRepairBtn) {
            int index = faultyList.getSelectedIndex();
            if (faultyList.getSelectedIndex() == -1) {
                JOptionPane.showMessageDialog(this, "No Aircraft Selected");
            } else {
                int mCode = mCodes2.get(index);
                int status = aircraftManagementDatabase.getStatus(mCode);
                if(status == ManagementRecord.AWAIT_REPAIR){
                    aircraftManagementDatabase.setStatus(mCode,ManagementRecord.READY_CLEAN_AND_MAINT);
                    aircraftManagementDatabase.repair(mCode);
                }
            }
        }
    }

    @Override
    public void update(Observable arg0, Object arg1) {
        faultyList.setSelectedIndex(-1);
        maintainList.setSelectedIndex(-1);
        maintDescription.setText("");
        faultDescription.setText("");
        updateMaintenanceList();
        updateFaultyList();
    }

    private void updateMaintenanceList() {
        mCodes1.clear();
        mCodes1.addAll(Arrays.asList(aircraftManagementDatabase.getWithStatus(ManagementRecord.READY_CLEAN_AND_MAINT)));
        mCodes1.addAll(Arrays.asList(aircraftManagementDatabase.getWithStatus(ManagementRecord.CLEAN_AWAIT_MAINT)));

        String[] flightCodes = new String[mCodes1.size()];
        for (int i = 0; i < mCodes1.size(); i++) {
            flightCodes[i] = aircraftManagementDatabase.getFlightCode(mCodes1.get(i)) + " :" + aircraftManagementDatabase.getStatusString(mCodes1.get(i));
        }

        maintainList.setListData(flightCodes);
        maintainList.updateUI();
    }

    private void updateFaultyList() {
        mCodes2.clear();
        mCodes2.addAll(Arrays.asList(aircraftManagementDatabase.getWithStatus(ManagementRecord.FAULTY_AWAIT_CLEAN)));
        mCodes2.addAll(Arrays.asList(aircraftManagementDatabase.getWithStatus(ManagementRecord.AWAIT_REPAIR)));

        String[] flightCodes = new String[mCodes2.size()];
        for (int i = 0; i < mCodes2.size(); i++) {
            flightCodes[i] = aircraftManagementDatabase.getFlightCode(mCodes2.get(i)) + " :" + aircraftManagementDatabase.getStatusString(mCodes2.get(i));
        }

        faultyList.setListData(flightCodes);
        faultyList.updateUI();
    }

}
